angular.module("gc.fastRepeat",[]).directive("fastRepeat",["$compile","$parse","$animate",function(a,b,c){"use strict";function d(a,b){return a.slice&&"$$"==a.slice(0,2)?void 0:b}function e(){return window.performance&&window.performance.now?window.performance.now():(new Date).getTime()}var f=0,g=!1,h=/^(\d+\.\d+)\./.exec(angular.version.full)[1]>1.3;return{restrict:"A",transclude:"element",priority:1e3,compile:function(a,i){return function(a,i,j,k,l){function m(){a.$$postDigest(function(){x.width(y.width()),v.$digest(),z(w,v,!0)})}function n(a,b){var c=v.$new(!1);c[r]=a,c.fastRepeatStatic=!1,c.fastRepeatDynamic=!0;var d=l(c,function(a){x.append(a)});return c.$$postDigest(function(){b(d)}),c.$digest(),c}var o,p=j.fastRepeat.split(" in "),q=p[1],r=p[0],s=b(q),t=b(j.fastRepeatDisableOpts)(a),u={},v=a.$new();v[r]=s(v)[0]||{},v.fastRepeatStatic=!0,v.fastRepeatDynamic=!1;var w=l(v,function(a,b){h?c.enabled(a,!1):c.enabled(!1,a)}),x=$("<div/>");$("body").append(x),v.$on("$destroy",function(){x.detach()}),x.css({position:"absolute",top:"-100%"});var y=i.parents().filter(function(){return"inline"!==$(this).css("display")}).first();x.width(y.width()),x.css({visibility:"hidden"}),x.append(w);var z=function(a,b,c){function d(c){return b[r]=c,b.$digest(),a.attr("fast-repeat-id",c.$$fastRepeatId),a.clone()}var e=s(b),g={};angular.forEach(e,function(a){a.$$fastRepeatId||(a.id?a.$$fastRepeatId=a.id:a._id?a.$$fastRepeatId=a._id:a.$$fastRepeatId=++f),g[a.$$fastRepeatId]=a}),angular.forEach(u,function(a,b){g[b]||a.el.detach()});var h=i;angular.forEach(e,function(a){var b=a.$$fastRepeatId,e=u[b];if(e){if(!e.compiled&&(c||!angular.equals(e.copy,a))||e.compiled&&e.item!==a){var f=d(a);e.el.replaceWith(f),e.el=f,e.copy=angular.copy(a),e.compiled=!1,e.item=a}}else t?(e={copy:angular.copy(a),item:a,el:$("<div/>"),compiled:!0},n(a,function(a){e.el.replaceWith(a),e.el=a})):e={copy:angular.copy(a),item:a,el:d(a)},u[b]=e;h.after(e.el.last()),h=e.el.last()})},A=!1;a.$watch(function(a){return JSON.stringify(s(a),d)},function(b){x.width(y.width()),A||(A=!0,g&&(o=e()),a.$$postDigest(function(){x.width(y.width()),v.$digest(),z(w,v),g&&(o=e()-o,console.log("Total time: ",o,"ms"),console.log("time per row: ",o/b.length)),A=!1}))},!1),j.fastRepeatWatch&&a.$watch(j.fastRepeatWatch,m),a.$on("fastRepeatForceRedraw",m),i.parent().on("click","[fast-repeat-id]",function(a){var b=$(this);if(!b.parents().filter("[fast-repeat-id]").length){a.stopPropagation();var c=b.attr("fast-repeat-id"),d=u[c].item,e=b.find("*").index(a.target),f=n(d,function(a){b.replaceWith(a),u[c]={compiled:!0,el:a,item:d},setTimeout(function(){e>=0?a.find("*").eq(e).trigger("click"):a.trigger("click")},0)});f.$digest()}});var B=function(){x.width(y.width())},C=$(window);C.on("resize",B),i.on("$destroy",function(){C.off("resize",B)})}}}}]);
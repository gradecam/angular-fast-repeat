angular.module("gc.fastRepeat",[]).directive("fastRepeat",["$compile","$parse","$animate","$rootScope",function(a,b,c){"use strict";function d(a,b){return a.slice&&"$$"==a.slice(0,2)?void 0:b}function e(){return window.performance&&window.performance.now?window.performance.now():(new Date).getTime()}var f=0,g=!1;return{restrict:"A",transclude:"element",priority:1e3,compile:function(){return function(a,h,i,j,k){function l(){a.$$postDigest(function(){w.width(x.width()),w.height(x.height()),u.$digest(),y(v,u,!0)})}function m(a,b){var c=u.$new(!1);c[q]=a,c.fastRepeatStatic=!1,c.fastRepeatDynamic=!0;var d=k(c,function(a){w.append(a)});return c.$$postDigest(function(){b(d)}),c.$digest(),c}var n,o=i.fastRepeat.split(" in "),p=o[1],q=o[0],r=b(p),s=b(i.fastRepeatDisableOpts)(a),t={},u=a.$new();u[q]=r(u)[0]||{},u.fastRepeatStatic=!0,u.fastRepeatDynamic=!1;var v=k(u,function(a){c.enabled(!1,a)}),w=$("<div/>");$("body").append(w),u.$on("$destroy",function(){w.detach()}),w.css({position:"absolute",top:"110%"});var x=h.parents().filter(function(){return"inline"!==$(this).css("display")}).first();w.width(x.width()),w.height(x.height()),w.css({visibility:"hidden"}),w.append(v);var y=function(a,b,c){function d(c){return b[q]=c,b.$digest(),a.attr("fast-repeat-id",c.$$fastRepeatId),a.clone()}var e=r(b),g={};angular.forEach(e,function(a){a.$$fastRepeatId||(a.$$fastRepeatId=a.id?a.id:a._id?a._id:++f),g[a.$$fastRepeatId]=a}),angular.forEach(t,function(a,b){g[b]||a.el.detach()});var i=h;angular.forEach(e,function(a){var b=a.$$fastRepeatId,e=t[b];if(e){if(!e.compiled&&(c||!angular.equals(e.copy,a))||e.compiled&&e.item!==a){var f=d(a);e.el.replaceWith(f),e.el=f,e.copy=angular.copy(a),e.compiled=!1,e.item=a}}else s?(e={copy:angular.copy(a),item:a,el:$("<div/>"),compiled:!0},m(a,function(a){e.el.replaceWith(a),e.el=a})):e={copy:angular.copy(a),item:a,el:d(a)},t[b]=e;i.after(e.el.last()),i=e.el.last()})},z=!1;a.$watch(function(a){return JSON.stringify(r(a),d)},function(b){w.width(x.width()),w.height(x.height()),z||(z=!0,g&&(n=e()),a.$$postDigest(function(){w.width(x.width()),w.height(x.height()),u.$digest(),y(v,u),g&&(n=e()-n,console.log("Total time: ",n,"ms"),console.log("time per row: ",n/b.length)),z=!1}))},!1),i.fastRepeatWatch&&a.$watch(i.fastRepeatWatch,l),a.$on("fastRepeatForceRedraw",l),h.parent().on("click","[fast-repeat-id]",function(a){var b=$(this);if(!b.parents().filter("[fast-repeat-id]").length){a.stopPropagation();var c=b.attr("fast-repeat-id"),d=t[c].item,e=b.find("*").index(a.target),f=m(d,function(a){b.replaceWith(a),t[c]={compiled:!0,el:a,item:d},setTimeout(function(){e>=0?a.find("*").eq(e).trigger("click"):a.trigger("click")},0)});f.$digest()}});var A=function(){w.width(x.width()),w.height(x.height())},B=$(window);B.on("resize",A),h.on("$destroy",function(){B.off("resize",A)})}}}}]);